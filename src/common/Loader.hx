package common;

import entities.Enemy;
import helpers.BuildingTypes.BuildFunctionReturn;
import common.WorldGrid.Position;
import helpers.BuildingTypes.BuildIndicator;
import common.WorldGrid.Cell;
import helpers.BuildingTypes.BuildingsMap;
import json2object.JsonParser;

typedef LoadData = {
	buildings:Map<String, Cell>,
	enemies:Array<Position>,
}

class Loader {
	public static function load() {
		// TODO: load from file
		var json = "{\"enemies\":[{\"x\":-24,\"y\":0},{\"x\":-23,\"y\":-1},{\"x\":-24,\"y\":-1},{\"x\":-23,\"y\":0}],\"buildings\":{\"WALL:1\":{\"x\":12,\"y\":0},\"WALL:2\":{\"x\":12,\"y\":1},\"WALL:3\":{\"x\":5,\"y\":-10},\"WALL:4\":{\"x\":12,\"y\":2},\"WALL:5\":{\"x\":-5,\"y\":13},\"WALL:6\":{\"x\":5,\"y\":-11},\"WALL:7\":{\"x\":12,\"y\":3},\"WALL:8\":{\"x\":-8,\"y\":-14},\"WALL:9\":{\"x\":-5,\"y\":14},\"WALL:100\":{\"x\":-23,\"y\":-12},\"WALL:101\":{\"x\":3,\"y\":10},\"WALL:102\":{\"x\":3,\"y\":11},\"WALL:103\":{\"x\":3,\"y\":12},\"WALL:104\":{\"x\":-21,\"y\":10},\"WALL:105\":{\"x\":-21,\"y\":11},\"WALL:106\":{\"x\":-21,\"y\":12},\"WALL:107\":{\"x\":-5,\"y\":-4},\"WALL:108\":{\"x\":-5,\"y\":-5},\"WALL:109\":{\"x\":-5,\"y\":-6},\"WALL:110\":{\"x\":-12,\"y\":-14},\"WALL:111\":{\"x\":-2,\"y\":12},\"WALL:112\":{\"x\":-12,\"y\":-15},\"WALL:113\":{\"x\":-2,\"y\":13},\"WALL:114\":{\"x\":-10,\"y\":-3},\"WALL:115\":{\"x\":7,\"y\":8},\"WALL:116\":{\"x\":-3,\"y\":-13},\"WALL:117\":{\"x\":7,\"y\":9},\"WALL:118\":{\"x\":-3,\"y\":-14},\"WALL:119\":{\"x\":-3,\"y\":-15},\"WALL:120\":{\"x\":-16,\"y\":12},\"WALL:121\":{\"x\":-16,\"y\":13},\"WALL:122\":{\"x\":10,\"y\":-5},\"WALL:123\":{\"x\":-7,\"y\":1},\"WALL:124\":{\"x\":10,\"y\":-6},\"WALL:125\":{\"x\":-7,\"y\":2},\"WALL:126\":{\"x\":10,\"y\":-7},\"WALL:127\":{\"x\":-7,\"y\":3},\"WALL:128\":{\"x\":10,\"y\":-8},\"WALL:129\":{\"x\":-29,\"y\":-3},\"WALL:130\":{\"x\":3,\"y\":-11},\"WALL:131\":{\"x\":-29,\"y\":-4},\"WALL:132\":{\"x\":3,\"y\":-12},\"WALL:133\":{\"x\":-29,\"y\":-5},\"WALL:134\":{\"x\":3,\"y\":-13},\"WALL:135\":{\"x\":-29,\"y\":-6},\"WALL:136\":{\"x\":-29,\"y\":-7},\"WALL:137\":{\"x\":-7,\"y\":13},\"WALL:138\":{\"x\":-7,\"y\":14},\"WALL:139\":{\"x\":-26,\"y\":7},\"WALL:140\":{\"x\":-26,\"y\":8},\"WALL:141\":{\"x\":-26,\"y\":9},\"WALL:142\":{\"x\":-31,\"y\":0},\"WALL:143\":{\"x\":-31,\"y\":1},\"WALL:144\":{\"x\":-31,\"y\":2},\"WALL:145\":{\"x\":-12,\"y\":13},\"WALL:146\":{\"x\":-12,\"y\":14},\"WALL:147\":{\"x\":-13,\"y\":3},\"WALL:148\":{\"x\":-13,\"y\":4},\"WALL:149\":{\"x\":-6,\"y\":-14},\"WALL:150\":{\"x\":-13,\"y\":5},\"WALL:151\":{\"x\":-6,\"y\":-15},\"WALL:152\":{\"x\":-16,\"y\":-13},\"WALL:153\":{\"x\":4,\"y\":10},\"WALL:154\":{\"x\":-16,\"y\":-14},\"WALL:155\":{\"x\":4,\"y\":11},\"WALL:156\":{\"x\":7,\"y\":-9},\"WALL:157\":{\"x\":-22,\"y\":10},\"WALL:158\":{\"x\":-25,\"y\":-9},\"WALL:159\":{\"x\":-22,\"y\":11},\"WALL:160\":{\"x\":10,\"y\":4},\"WALL:161\":{\"x\":-6,\"y\":-3},\"WALL:162\":{\"x\":10,\"y\":5},\"WALL:163\":{\"x\":-6,\"y\":-4},\"WALL:164\":{\"x\":10,\"y\":6},\"WALL:165\":{\"x\":-6,\"y\":-5},\"WALL:166\":{\"x\":10,\"y\":7},\"WALL:167\":{\"x\":6,\"y\":-10},\"WALL:168\":{\"x\":6,\"y\":-11},\"WALL:169\":{\"x\":-3,\"y\":12},\"WALL:170\":{\"x\":-11,\"y\":-2},\"WALL:171\":{\"x\":-3,\"y\":13},\"WALL:172\":{\"x\":-11,\"y\":-3},\"WALL:173\":{\"x\":-3,\"y\":14},\"WALL:174\":{\"x\":-7,\"y\":-14},\"WALL:175\":{\"x\":-11,\"y\":-4},\"WALL:176\":{\"x\":-7,\"y\":-15},\"WALL:177\":{\"x\":-17,\"y\":12},\"WALL:178\":{\"x\":8,\"y\":7},\"WALL:179\":{\"x\":-17,\"y\":13},\"WALL:180\":{\"x\":8,\"y\":8},\"WALL:181\":{\"x\":7,\"y\":-10},\"WALL:182\":{\"x\":8,\"y\":9},\"WALL:183\":{\"x\":7,\"y\":-11},\"WALL:184\":{\"x\":11,\"y\":-3},\"WALL:185\":{\"x\":11,\"y\":-4},\"WALL:186\":{\"x\":11,\"y\":-5},\"WALL:187\":{\"x\":11,\"y\":-6},\"WALL:188\":{\"x\":11,\"y\":-7},\"WALL:189\":{\"x\":-20,\"y\":-12},\"WALL:190\":{\"x\":-20,\"y\":-13},\"WALL:191\":{\"x\":-8,\"y\":2},\"WALL:192\":{\"x\":-17,\"y\":-13},\"WALL:193\":{\"x\":-17,\"y\":-14},\"WALL:194\":{\"x\":0,\"y\":-12},\"WALL:195\":{\"x\":0,\"y\":-13},\"WALL:196\":{\"x\":-8,\"y\":13},\"WALL:197\":{\"x\":0,\"y\":-14},\"WALL:198\":{\"x\":-8,\"y\":14},\"WALL:199\":{\"x\":-21,\"y\":-11},\"WALL:200\":{\"x\":-21,\"y\":-12},\"WALL:201\":{\"x\":-21,\"y\":-13},\"WALL:202\":{\"x\":-4,\"y\":4},\"WALL:203\":{\"x\":-27,\"y\":6},\"WALL:204\":{\"x\":-4,\"y\":5},\"WALL:205\":{\"x\":-27,\"y\":7},\"WALL:206\":{\"x\":-27,\"y\":8},\"WALL:207\":{\"x\":-13,\"y\":13},\"WALL:208\":{\"x\":-13,\"y\":14},\"WALL:209\":{\"x\":-24,\"y\":-10},\"WALL:210\":{\"x\":0,\"y\":11},\"WALL:211\":{\"x\":-24,\"y\":-11},\"WALL:212\":{\"x\":0,\"y\":12},\"WALL:213\":{\"x\":0,\"y\":13},\"WALL:214\":{\"x\":-10,\"y\":-14},\"WALL:215\":{\"x\":-10,\"y\":-15},\"WALL:216\":{\"x\":5,\"y\":10},\"WALL:217\":{\"x\":8,\"y\":-8},\"WALL:218\":{\"x\":5,\"y\":11},\"WALL:219\":{\"x\":8,\"y\":-9},\"WALL:220\":{\"x\":-14,\"y\":4},\"WALL:221\":{\"x\":-23,\"y\":9},\"WALL:222\":{\"x\":-14,\"y\":5},\"WALL:223\":{\"x\":-26,\"y\":-8},\"WALL:224\":{\"x\":-23,\"y\":10},\"WALL:225\":{\"x\":-26,\"y\":-9},\"WALL:226\":{\"x\":-23,\"y\":11},\"WALL:227\":{\"x\":-7,\"y\":-2},\"WALL:228\":{\"x\":-7,\"y\":-3},\"WALL:229\":{\"x\":-7,\"y\":-4},\"WALL:230\":{\"x\":11,\"y\":2},\"WALL:231\":{\"x\":11,\"y\":3},\"WALL:232\":{\"x\":11,\"y\":4},\"WALL:233\":{\"x\":11,\"y\":5},\"WALL:234\":{\"x\":-13,\"y\":-14},\"WALL:235\":{\"x\":11,\"y\":6},\"WALL:236\":{\"x\":-13,\"y\":-15},\"WALL:237\":{\"x\":-4,\"y\":13},\"WALL:238\":{\"x\":-10,\"y\":2},\"WALL:239\":{\"x\":-12,\"y\":-3},\"WALL:240\":{\"x\":-4,\"y\":14},\"WALL:241\":{\"x\":-12,\"y\":-4},\"WALL:242\":{\"x\":-12,\"y\":-5},\"WALL:243\":{\"x\":-18,\"y\":11},\"WALL:244\":{\"x\":-18,\"y\":12},\"WALL:245\":{\"x\":-18,\"y\":13},\"WALL:246\":{\"x\":12,\"y\":-1},\"WALL:247\":{\"x\":9,\"y\":6},\"WALL:248\":{\"x\":12,\"y\":-2},\"WALL:249\":{\"x\":9,\"y\":7},\"WALL:250\":{\"x\":12,\"y\":-3},\"WALL:251\":{\"x\":9,\"y\":8},\"WALL:252\":{\"x\":12,\"y\":-4},\"WALL:253\":{\"x\":12,\"y\":-5},\"WALL:254\":{\"x\":1,\"y\":11},\"WALL:255\":{\"x\":1,\"y\":12},\"WALL:256\":{\"x\":-25,\"y\":-10},\"WALL:257\":{\"x\":-25,\"y\":-11},\"WALL:258\":{\"x\":5,\"y\":9},\"WALL:259\":{\"x\":-9,\"y\":13},\"WALL:260\":{\"x\":-9,\"y\":14},\"WALL:261\":{\"x\":-4,\"y\":-14},\"WALL:262\":{\"x\":-4,\"y\":-15},\"WALL:263\":{\"x\":-28,\"y\":4},\"WALL:264\":{\"x\":-5,\"y\":3},\"WALL:265\":{\"x\":-14,\"y\":13},\"WALL:266\":{\"x\":-14,\"y\":-14},\"WALL:267\":{\"x\":-28,\"y\":5},\"WALL:268\":{\"x\":-5,\"y\":4},\"WALL:269\":{\"x\":-14,\"y\":-15},\"WALL:270\":{\"x\":-14,\"y\":14},\"WALL:271\":{\"x\":-28,\"y\":6},\"WALL:272\":{\"x\":-30,\"y\":-1},\"WALL:273\":{\"x\":-5,\"y\":5},\"WALL:274\":{\"x\":-28,\"y\":7},\"WALL:275\":{\"x\":-30,\"y\":-2},\"WALL:276\":{\"x\":-30,\"y\":-3},\"WALL:277\":{\"x\":-30,\"y\":-4},\"WALL:278\":{\"x\":-30,\"y\":-5},\"WALL:279\":{\"x\":4,\"y\":-11},\"WALL:280\":{\"x\":4,\"y\":-12},\"WALL:281\":{\"x\":9,\"y\":-7},\"WALL:282\":{\"x\":6,\"y\":10},\"WALL:283\":{\"x\":9,\"y\":-8},\"WALL:284\":{\"x\":9,\"y\":-9},\"WALL:285\":{\"x\":-5,\"y\":-14},\"WALL:286\":{\"x\":-5,\"y\":-15},\"WALL:287\":{\"x\":-27,\"y\":-7},\"WALL:288\":{\"x\":-27,\"y\":-8},\"WALL:289\":{\"x\":-24,\"y\":10},\"WALL:290\":{\"x\":-27,\"y\":-9},\"WALL:291\":{\"x\":-8,\"y\":-3},\"WALL:292\":{\"x\":-24,\"y\":9},\"WALL:10\":{\"x\":5,\"y\":-12},\"WALL:11\":{\"x\":12,\"y\":4},\"WALL:12\":{\"x\":-8,\"y\":-15},\"WALL:13\":{\"x\":-13,\"y\":-4},\"WALL:14\":{\"x\":-13,\"y\":-5},\"WALL:15\":{\"x\":-26,\"y\":-10},\"WALL:16\":{\"x\":-13,\"y\":-6},\"WALL:17\":{\"x\":-11,\"y\":1},\"WALL:18\":{\"x\":-11,\"y\":2},\"WALL:19\":{\"x\":-11,\"y\":3},\"WALL:20\":{\"x\":-10,\"y\":13},\"WALL:21\":{\"x\":-10,\"y\":14},\"WALL:22\":{\"x\":-19,\"y\":11},\"WALL:23\":{\"x\":-19,\"y\":12},\"WALL:24\":{\"x\":8,\"y\":-10},\"WALL:25\":{\"x\":13,\"y\":-1},\"WALL:26\":{\"x\":13,\"y\":-2},\"WALL:27\":{\"x\":13,\"y\":-3},\"WALL:28\":{\"x\":-15,\"y\":-13},\"WALL:29\":{\"x\":2,\"y\":11},\"WALL:30\":{\"x\":-15,\"y\":-14},\"WALL:31\":{\"x\":2,\"y\":12},\"WALL:32\":{\"x\":-15,\"y\":-15},\"WALL:33\":{\"x\":-20,\"y\":11},\"WALL:34\":{\"x\":-20,\"y\":12},\"WALL:35\":{\"x\":-4,\"y\":-5},\"WALL:36\":{\"x\":-4,\"y\":-6},\"WALL:37\":{\"x\":-18,\"y\":-12},\"WALL:38\":{\"x\":-1,\"y\":12},\"WALL:39\":{\"x\":-18,\"y\":-13},\"WALL:40\":{\"x\":-1,\"y\":13},\"WALL:41\":{\"x\":-18,\"y\":-14},\"WALL:42\":{\"x\":6,\"y\":9},\"WALL:43\":{\"x\":-15,\"y\":12},\"WALL:44\":{\"x\":-15,\"y\":13},\"WALL:45\":{\"x\":-15,\"y\":14},\"WALL:46\":{\"x\":-31,\"y\":-1},\"WALL:47\":{\"x\":-31,\"y\":-2},\"WALL:48\":{\"x\":-29,\"y\":2},\"WALL:49\":{\"x\":-9,\"y\":-14},\"WALL:50\":{\"x\":-31,\"y\":-3},\"WALL:51\":{\"x\":-29,\"y\":3},\"WALL:52\":{\"x\":-6,\"y\":2},\"WALL:53\":{\"x\":-9,\"y\":-15},\"WALL:54\":{\"x\":-29,\"y\":4},\"WALL:55\":{\"x\":-6,\"y\":3},\"WALL:56\":{\"x\":-29,\"y\":5},\"WALL:57\":{\"x\":-1,\"y\":-13},\"WALL:58\":{\"x\":-6,\"y\":4},\"WALL:59\":{\"x\":-29,\"y\":6},\"WALL:60\":{\"x\":-1,\"y\":-14},\"WALL:61\":{\"x\":-11,\"y\":-14},\"WALL:62\":{\"x\":-11,\"y\":-15},\"WALL:63\":{\"x\":7,\"y\":10},\"WALL:64\":{\"x\":-28,\"y\":-5},\"WALL:65\":{\"x\":-28,\"y\":-6},\"WALL:66\":{\"x\":-28,\"y\":-7},\"WALL:67\":{\"x\":-28,\"y\":-8},\"WALL:68\":{\"x\":-25,\"y\":10},\"WALL:69\":{\"x\":1,\"y\":-12},\"WALL:70\":{\"x\":1,\"y\":-13},\"WALL:71\":{\"x\":-2,\"y\":-13},\"WALL:72\":{\"x\":-25,\"y\":8},\"WALL:73\":{\"x\":-2,\"y\":-14},\"WALL:74\":{\"x\":-25,\"y\":9},\"WALL:75\":{\"x\":-22,\"y\":-11},\"WALL:76\":{\"x\":-30,\"y\":0},\"WALL:77\":{\"x\":-22,\"y\":-12},\"WALL:78\":{\"x\":-6,\"y\":13},\"WALL:79\":{\"x\":-30,\"y\":1},\"WALL:80\":{\"x\":-6,\"y\":14},\"WALL:81\":{\"x\":-30,\"y\":2},\"WALL:82\":{\"x\":13,\"y\":0},\"WALL:83\":{\"x\":-30,\"y\":3},\"WALL:84\":{\"x\":-14,\"y\":-5},\"WALL:85\":{\"x\":13,\"y\":1},\"WALL:86\":{\"x\":-30,\"y\":4},\"WALL:87\":{\"x\":-14,\"y\":-6},\"WALL:88\":{\"x\":13,\"y\":2},\"WALL:89\":{\"x\":-11,\"y\":13},\"WALL:90\":{\"x\":-11,\"y\":14},\"WALL:91\":{\"x\":-19,\"y\":-12},\"WALL:92\":{\"x\":-12,\"y\":2},\"WALL:93\":{\"x\":-19,\"y\":-13},\"WALL:94\":{\"x\":-12,\"y\":3},\"WALL:95\":{\"x\":-12,\"y\":4},\"WALL:96\":{\"x\":2,\"y\":-12},\"WALL:97\":{\"x\":2,\"y\":-13},\"WALL:98\":{\"x\":-23,\"y\":-10},\"WALL:99\":{\"x\":-23,\"y\":-11}}}";
		var parser = new JsonParser<LoadData>();
		var data = parser.fromJson(json);

		// LOAD BUILDINGS
		for (buildingKey in data.buildings.keys()) {
			var name = buildingKey.split(":")[0];
			var cell:Cell = data.buildings[buildingKey];
			var buildSize:Null<BuildIndicator> = null;

			var buildFunction:Null<(position:Position) -> BuildFunctionReturn> = null;
			for (i in BuildingsMap) {
				if (i.name == name) {
					buildSize = i.buildIndicator;
					buildFunction = i.buildFunction;
					break;
				}
			}
			trace(buildSize);
			if (buildSize != null && buildFunction != null) {
				OrderHandler.instantDeliveryOrder(cell, name, buildSize, buildFunction);
			}
		}

		// LOAD ENEMIES
		for (enemyPos in data.enemies) {
			new Enemy({x: enemyPos.x * 32, y: enemyPos.y * 32});
		}
	}
}
